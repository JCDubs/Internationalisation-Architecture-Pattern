# Order Service Example Project.

## Introduction

This project is an example Serverless order servie API providing all CRUD operations and authentication.

## Deployment

The Order API can be deployed to an AWS account using the CDK deploy command.

```bash
$ npx cdk deploy --all
```

Doing so will create the `auth`, `stateful` and `stateless` Cloudformation stacks. The API will then be available through the auto generated, public API Gateway URL.

## Order, Customer and User Data Hydration

The project contains a directory named `scripts` containing a number of utility scripts to be used to hydrate the order and customer database and the Cognito user pool. They are to be executed once all stacks have been completelty deployed.

### Order and Customer Data Hydration Script

The `scripts/hydrate.js` script should be executed post deployment to insert the canned order and customer data into the database using the following command.

```bash
$ ./scripts/hydrate.js
```

The script will insert two customers and a number of orders into the database with static IDs that are referenced in the included Postman tests.

### User and Group Data Hydration Script

The `scripts/create-users.js` script populates the Cognito user group with a number of users and user groups to be used with the REST API. Before running the script, the `userPoolId` value of `{USER_POOL_ID}` should be replaced with the id of the user pool created during the CDK deployment.

```bash
$ ./scripts/create-users.js
```

The data persisted to the Cognito user pool represent all of the possible users and roles that can use the Order REST API.

## Using the API

The Order API can be used post-deployment via the public URL generated by the API Gateway deployment. The API requires callers to be logged into the Cognito user pool.

### User Login

Login utility scripts have been provided in the `scripts/login` directory for each user that logs in the user on execution. The users ID Token is displayed in the console on completion that can be used when sending requests to the REST API. Before running the login scripts, the `clientId` value of `{CLIENT_ID}` should be replaced with the id of the user pool client created during the CDK deployment.

### Postman Collection

A postman collection named `Auth.postman_collection.json` has been included in the project that contains all of the possible requests users and groups of users can send to the API, provided with a suffix stating whether the request should be allowed or denied. 

The postman collection requires two environment variables providing the URL of the API and the users auth ID Token. 
